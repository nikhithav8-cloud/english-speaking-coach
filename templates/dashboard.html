<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gayathri Speak Smart</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --purple:      #667eea;
            --purple-dark: #764ba2;
            --green:       #00b894;
            --teal:        #00cec9;
            --bg:          #f0f2ff;
            --card:        #ffffff;
            --text:        #2d3436;
            --muted:       #636e72;
            --border:      #e0e4ff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #6b6fc5 0%, #7b5ea7 40%, #9b6bbf 70%, #b07fd4 100%);
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            padding: 24px 16px; position: relative; overflow-x: hidden;
        }

        .bg-blob { position:fixed; border-radius:50%; pointer-events:none; animation:blobFloat 18s ease-in-out infinite; }
        .blob1 { width:500px;height:500px;background:rgba(255,255,255,.07);bottom:-160px;right:-140px; }
        .blob2 { width:360px;height:360px;background:rgba(255,255,255,.07);top:-110px;left:-110px;animation-delay:6s; }
        .blob3 { width:160px;height:160px;background:rgba(255,255,255,.06);top:44%;right:4%;animation-delay:10s; }
        @keyframes blobFloat { 0%,100%{transform:translateY(0) scale(1);} 50%{transform:translateY(-28px) scale(1.04);} }

        .deco-star { position:fixed; pointer-events:none; color:rgba(255,255,255,.5); animation:starTwinkle 4s ease-in-out infinite; }
        @keyframes starTwinkle { 0%,100%{opacity:.2;transform:scale(1);} 50%{opacity:.65;transform:scale(1.3);} }

        .card {
            background:var(--card); border-radius:28px; width:100%; max-width:780px;
            box-shadow:0 24px 80px rgba(102,126,234,.2),0 4px 16px rgba(0,0,0,.06);
            position:relative; z-index:10; overflow:hidden;
            animation:cardPop .6s cubic-bezier(.34,1.56,.64,1) both;
        }
        @keyframes cardPop { from{transform:scale(.9) translateY(24px);opacity:0;} to{transform:scale(1) translateY(0);opacity:1;} }

        .card-banner {
            background:linear-gradient(135deg,var(--purple),var(--purple-dark));
            padding:32px 32px 52px; position:relative; overflow:hidden;
        }
        .card-banner::after {
            content:''; position:absolute; bottom:-1px; left:0; right:0;
            height:32px; background:var(--card); border-radius:32px 32px 0 0;
        }
        .bb { position:absolute; border-radius:50%; background:rgba(255,255,255,.1); pointer-events:none; }
        .bb1 { width:220px;height:220px;bottom:-80px;right:-60px; }
        .bb2 { width:130px;height:130px;top:-40px;right:160px; }

        .profile-area { position:relative; z-index:2; }
        .avatar-ring {
            width:80px; height:80px; background:rgba(255,255,255,.22);
            border:3px solid rgba(255,255,255,.4); border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            font-size:40px; margin-bottom:14px;
            box-shadow:0 8px 24px rgba(0,0,0,.15);
            animation:owlBounce 2.6s ease-in-out infinite;
        }
        @keyframes owlBounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-7px);} }

        .welcome-lbl { font-size:13px; font-weight:700; color:rgba(255,255,255,.75); text-transform:uppercase; letter-spacing:1px; margin-bottom:4px; }
        .student-name { font-family:'Fredoka One',cursive; font-size:34px; color:#fff; line-height:1.1; margin-bottom:12px; text-shadow:0 2px 12px rgba(0,0,0,.15); }

        .id-chips { display:flex; gap:8px; flex-wrap:wrap; }
        .id-chip { background:rgba(255,255,255,.18); border:1.5px solid rgba(255,255,255,.28); border-radius:50px; padding:5px 13px; font-size:12px; font-weight:700; color:#fff; backdrop-filter:blur(6px); }
        .id-chip.gold { background:rgba(255,215,0,.25); border-color:rgba(255,215,0,.5); }

        .card-body { padding:24px 28px 28px; }

        .stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:22px; }
        .stat-box { background:var(--bg); border:2px solid var(--border); border-radius:16px; padding:16px 10px; text-align:center; transition:transform .2s,box-shadow .2s; }
        .stat-box:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(102,126,234,.15); }
        .stat-icon { font-size:22px; margin-bottom:6px; }
        .stat-val  { font-family:'Fredoka One',cursive; font-size:22px; color:var(--purple-dark); line-height:1; }
        .stat-lbl  { font-size:11px; font-weight:700; color:var(--muted); margin-top:3px; text-transform:uppercase; letter-spacing:.4px; }

        .daily-dash-banner {
            border-radius:14px; padding:14px 18px; margin-bottom:16px;
            display:flex; align-items:center; gap:14px;
            background:linear-gradient(135deg,#00b894,#00cec9);
            box-shadow:0 5px 16px rgba(0,184,148,.25);
            cursor:pointer; transition:all .3s; text-decoration:none;
        }
        .daily-dash-banner:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,184,148,.35); }
        .daily-dash-banner.done { background:linear-gradient(135deg,#b2bec3,#95a5a6); cursor:default; pointer-events:none; }
        .ddb-icon { font-size:30px; flex-shrink:0; }
        .ddb-text { flex:1; }
        .ddb-title { font-size:14px; font-weight:900; color:white; margin-bottom:2px; }
        .ddb-sub   { font-size:12px; color:rgba(255,255,255,.85); }
        .ddb-xp    { background:rgba(255,255,255,.2); color:white; font-weight:900; font-size:14px; padding:6px 12px; border-radius:10px; flex-shrink:0; }

        .quote-box { background:linear-gradient(135deg,#fff9e6,#ffe8f5); border:2px solid #f5d9f7; border-left:5px solid var(--purple); border-radius:16px; padding:18px 20px; margin-bottom:22px; }
        .quote-text   { font-size:14px; font-weight:700; color:#555; font-style:italic; line-height:1.65; }
        .quote-author { font-size:12px; font-weight:800; color:var(--purple); margin-top:8px; }

        .actions-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-bottom:16px; }
        .btn {
            padding:14px 10px; border:none; border-radius:14px;
            font-family:'Nunito',sans-serif; font-size:14px; font-weight:800;
            cursor:pointer; transition:all .25s; text-decoration:none;
            display:flex; align-items:center; justify-content:center; gap:8px;
        }
        .btn-start    { background:linear-gradient(135deg,var(--purple),var(--purple-dark)); color:white; box-shadow:0 6px 20px rgba(102,126,234,.4); }
        .btn-start:hover    { transform:translateY(-3px); box-shadow:0 12px 28px rgba(102,126,234,.5); }
        .btn-progress { background:linear-gradient(135deg,var(--green),var(--teal)); color:white; box-shadow:0 6px 20px rgba(0,184,148,.3); }
        .btn-progress:hover { transform:translateY(-2px); box-shadow:0 10px 24px rgba(0,184,148,.4); }
        .btn-logout   { background:var(--bg); color:var(--muted); border:2px solid var(--border); }
        .btn-logout:hover   { border-color:var(--purple); color:var(--purple-dark); }

        .danger-zone { border:2px dashed #ffd0d0; border-radius:14px; padding:14px 18px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
        .danger-label { font-size:12px; font-weight:700; color:#c0392b; }
        .danger-sub   { font-size:11px; color:var(--muted); margin-top:2px; }
        .btn-delete { padding:8px 16px; background:#fde8e8; color:#c0392b; border:2px solid #f5a5a5; border-radius:10px; font-family:'Nunito',sans-serif; font-size:12px; font-weight:800; cursor:pointer; transition:all .25s; flex-shrink:0; }
        .btn-delete:hover { background:#ff6b6b; color:white; border-color:#ff6b6b; transform:translateY(-1px); }

        /* ‚îÄ‚îÄ Modals ‚îÄ‚îÄ */
        .modal { display:none; position:fixed; inset:0; background:rgba(20,20,40,.6); z-index:1000; backdrop-filter:blur(6px); justify-content:center; align-items:flex-start; padding:20px; overflow-y:auto; }
        .modal.active { display:flex; }

        .modal-box-sm { background:white; border-radius:24px; padding:36px 30px; max-width:420px; width:100%; box-shadow:0 28px 72px rgba(0,0,0,.25); animation:cardPop .4s cubic-bezier(.34,1.56,.64,1) both; text-align:center; margin:auto; }
        .modal-icon  { font-size:54px; margin-bottom:12px; }
        .modal-title { font-family:'Fredoka One',cursive; font-size:22px; color:#c0392b; margin-bottom:10px; }
        .modal-body  { font-size:14px; color:var(--muted); line-height:1.6; margin-bottom:16px; }
        .modal-warn  { background:#fff3cd; border:2px solid #ffc107; border-radius:12px; padding:13px 15px; margin-bottom:20px; color:#856404; font-size:13px; font-weight:700; text-align:left; line-height:1.7; }
        .modal-btns  { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
        .mbtn { padding:12px 24px; border:none; border-radius:11px; font-family:'Nunito',sans-serif; font-size:14px; font-weight:800; cursor:pointer; transition:all .25s; }
        .mbtn-cancel { background:var(--bg); color:var(--text); border:2px solid var(--border); }
        .mbtn-cancel:hover { background:#e0e4ff; }
        .mbtn-danger { background:linear-gradient(135deg,#ff6b6b,#ee5a6f); color:white; }
        .mbtn-danger:hover { transform:translateY(-2px); }
        .mbtn:disabled { opacity:.6; cursor:not-allowed; transform:none !important; }

        .modal-box-lg { background:white; border-radius:24px; padding:32px 28px; max-width:640px; width:100%; max-height:calc(100vh - 40px); overflow-y:auto; box-shadow:0 28px 72px rgba(0,0,0,.25); animation:cardPop .4s cubic-bezier(.34,1.56,.64,1) both; position:relative; margin:auto; }
        .modal-close { position:absolute; top:14px; right:16px; width:32px; height:32px; border-radius:50%; border:none; background:#f5f5f5; font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:900; color:#666; }
        .modal-close:hover { background:#ffe0e0; color:#c0392b; }

        /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
        .modal-tabs { display:flex; gap:6px; margin-bottom:22px; background:var(--bg); border-radius:12px; padding:5px; }
        .tab-btn {
            flex:1; padding:10px 8px; border:none; border-radius:9px;
            font-family:'Nunito',sans-serif; font-size:13px; font-weight:800;
            cursor:pointer; transition:all .2s; background:transparent; color:var(--muted);
        }
        .tab-btn.active { background:white; color:var(--purple-dark); box-shadow:0 2px 8px rgba(102,126,234,.18); }
        .tab-btn:hover:not(.active) { background:rgba(255,255,255,.6); color:var(--text); }
        .tab-pane { display:none; }
        .tab-pane.active { display:block; }

        /* ‚îÄ‚îÄ Overview tab ‚îÄ‚îÄ */
        .prog-title { font-family:'Fredoka One',cursive; font-size:22px; color:var(--purple-dark); margin-bottom:20px; text-align:center; }
        .prog-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:22px; }
        .prog-stat  { background:var(--bg); border:2px solid var(--border); border-radius:14px; padding:14px 10px; text-align:center; }
        .ps-icon { font-size:20px; margin-bottom:4px; }
        .ps-val  { font-family:'Fredoka One',cursive; font-size:20px; color:var(--purple-dark); }
        .ps-lbl  { font-size:10px; font-weight:700; color:var(--muted); text-transform:uppercase; letter-spacing:.4px; margin-top:2px; }

        .xp-section { margin-bottom:24px; }
        .xp-section h3 { font-size:13px; font-weight:800; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:12px; }
        .xp-bar-row { margin-bottom:12px; }
        .xp-bar-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; }
        .xp-bar-label { font-size:13px; font-weight:700; color:var(--text); }
        .xp-bar-val   { font-size:13px; font-weight:800; color:var(--purple-dark); }
        .xp-bar-track { height:10px; background:var(--border); border-radius:6px; overflow:hidden; }
        .xp-bar-fill  { height:100%; border-radius:6px; background:linear-gradient(90deg,var(--purple),var(--purple-dark)); transition:width .8s ease; }
        .xp-bar-fill.green { background:linear-gradient(90deg,#00b894,#00cec9); }

        .next-unlock-box { background:linear-gradient(135deg,#ffeaa7,#fdcb6e); border:2px solid #f39c12; border-radius:12px; padding:12px 16px; margin-bottom:18px; font-size:13px; font-weight:700; color:#2d3436; text-align:center; }

        .unlock-section h3 { font-size:13px; font-weight:800; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:12px; }
        .feature-pills { display:flex; flex-wrap:wrap; gap:8px; }
        .feat-pill { padding:7px 14px; border-radius:50px; font-size:12px; font-weight:800; display:flex; align-items:center; gap:5px; }
        .feat-unlocked { background:#d4f5ee; color:#00796b; border:2px solid #80cbc4; }
        .feat-locked   { background:#f5f5f5; color:#aaa; border:2px dashed #ddd; }
        .feat-bonus    { background:#fff3e0; color:#e65100; border:2px solid #ffb74d; }

        /* ‚îÄ‚îÄ Mistake Tracker tab ‚îÄ‚îÄ */
        .tracker-section { margin-bottom:22px; }
        .tracker-section h3 { font-size:13px; font-weight:800; color:var(--muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:12px; }

        /* Mode score cards */
        .mode-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:6px; }
        .mode-card { background:var(--bg); border:2px solid var(--border); border-radius:14px; padding:13px 14px; display:flex; align-items:center; gap:10px; transition:transform .2s; }
        .mode-card:hover { transform:translateY(-2px); }
        .mode-card.struggling { border-color:#ff7675; background:#fff5f5; }
        .mode-card.improving  { border-color:#fdcb6e; background:#fffbf0; }
        .mode-card.strong     { border-color:#00b894; background:#f0faf7; }
        .mode-card.untried    { border-color:#b2bec3; background:#f9f9f9; }
        .mc-icon { font-size:22px; flex-shrink:0; }
        .mc-body { flex:1; min-width:0; }
        .mc-label { font-size:12px; font-weight:800; color:var(--text); }
        .mc-score { font-size:11px; color:var(--muted); margin-top:2px; }
        .mc-badge { font-size:10px; font-weight:800; padding:2px 8px; border-radius:20px; margin-top:4px; display:inline-block; }
        .badge-struggle { background:#ffeaea; color:#c0392b; }
        .badge-improve  { background:#fff3cd; color:#856404; }
        .badge-strong   { background:#d4f5ee; color:#00796b; }
        .badge-untried  { background:#f0f0f0; color:#888; }

        /* Score mini bar */
        .mc-bar-track { height:5px; background:#e0e4ff; border-radius:3px; margin-top:5px; overflow:hidden; }
        .mc-bar-fill  { height:100%; border-radius:3px; transition:width .6s ease; }
        .fill-struggle { background:linear-gradient(90deg,#ff7675,#e17055); }
        .fill-improve  { background:linear-gradient(90deg,#fdcb6e,#e17055); }
        .fill-strong   { background:linear-gradient(90deg,#00b894,#00cec9); }
        .fill-untried  { background:#b2bec3; }

        /* Weak sessions */
        .weak-list { display:flex; flex-direction:column; gap:7px; }
        .weak-item { background:#fff5f5; border:1.5px solid #ffd0d0; border-radius:10px; padding:10px 13px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
        .wi-mode { font-size:12px; font-weight:800; color:var(--text); }
        .wi-date { font-size:11px; color:var(--muted); }
        .wi-score { font-size:13px; font-weight:900; color:#e74c3c; background:#ffeaea; padding:3px 10px; border-radius:8px; }

        /* Suggestions */
        .suggestion-list { display:flex; flex-direction:column; gap:10px; }
        .suggestion-card {
            border-radius:14px; padding:14px 16px;
            display:flex; align-items:flex-start; gap:12px;
            border:2px solid transparent; transition:transform .2s;
            animation:fadeInUp .4s ease both;
        }
        .suggestion-card:hover { transform:translateY(-2px); }
        @keyframes fadeInUp { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }

        .sug-struggle { background:#fff5f5; border-color:#ffd0d0; }
        .sug-improve  { background:#fffbf0; border-color:#ffeaa7; }
        .sug-praise   { background:#f0faf7; border-color:#b2dfdb; }
        .sug-streak   { background:#fff9e6; border-color:#fdcb6e; }
        .sug-explore  { background:#f0f4ff; border-color:#c5cae9; }
        .sug-retry    { background:#fff3e0; border-color:#ffe0b2; }
        .sug-milestone{ background:#f3e5f5; border-color:#ce93d8; }
        .sug-stars    { background:#fffde7; border-color:#fff176; }
        .sug-info     { background:#e8f5e9; border-color:#a5d6a7; }

        .sug-icon { font-size:26px; flex-shrink:0; margin-top:2px; }
        .sug-body { flex:1; }
        .sug-title { font-size:13px; font-weight:900; color:var(--text); margin-bottom:4px; }
        .sug-msg   { font-size:12px; font-weight:600; color:var(--muted); line-height:1.55; }
        .sug-action {
            margin-top:8px; display:inline-block;
            padding:5px 12px; border-radius:8px; font-size:11px; font-weight:800;
            background:var(--purple); color:white; text-decoration:none;
            transition:opacity .2s;
        }
        .sug-action:hover { opacity:.85; }

        /* Recent sessions */
        .recent-list { display:flex; flex-direction:column; gap:7px; }
        .recent-item { background:var(--bg); border:1.5px solid var(--border); border-radius:10px; padding:10px 13px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
        .ri-left { display:flex; align-items:center; gap:8px; }
        .ri-mode  { font-size:12px; font-weight:800; color:var(--text); }
        .ri-date  { font-size:11px; color:var(--muted); }
        .ri-right { display:flex; align-items:center; gap:6px; }
        .ri-score { font-size:12px; font-weight:900; padding:2px 8px; border-radius:7px; }
        .score-great { background:#d4f5ee; color:#00796b; }
        .score-ok    { background:#fff3cd; color:#856404; }
        .score-low   { background:#ffeaea; color:#c0392b; }
        .ri-xp { font-size:11px; font-weight:800; color:var(--purple-dark); }

        .no-data-msg { text-align:center; padding:24px; color:var(--muted); font-weight:700; font-size:13px; background:var(--bg); border-radius:12px; }

        .prog-loading { text-align:center; padding:40px; color:var(--muted); font-weight:700; font-size:15px; }
        .spin { display:inline-block; width:28px; height:28px; border:3px solid var(--border); border-top-color:var(--purple); border-radius:50%; animation:spin .7s linear infinite; margin-bottom:12px; }
        @keyframes spin { to { transform:rotate(360deg); } }

        @media(max-width:560px){
            .card-banner { padding:28px 20px 44px; }
            .student-name { font-size:26px; }
            .card-body { padding:20px 18px 22px; }
            .stats-row { grid-template-columns:repeat(2,1fr); }
            .actions-grid { grid-template-columns:1fr !important; }
            .danger-zone { flex-direction:column; text-align:center; }
            .prog-stats { grid-template-columns:repeat(2,1fr); }
            .mode-grid { grid-template-columns:1fr; }
            .modal-tabs { flex-wrap:wrap; }
        }
    </style>
</head>
<body>

<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>
<div class="bg-blob blob3"></div>
<div class="deco-star" style="top:10%;left:16%;font-size:18px;">‚òÖ</div>
<div class="deco-star" style="top:7%;right:20%;font-size:14px;animation-delay:1s;">‚ú¶</div>
<div class="deco-star" style="bottom:18%;left:13%;font-size:22px;animation-delay:2s;">‚òÖ</div>
<div class="deco-star" style="bottom:28%;right:16%;font-size:13px;animation-delay:.5s;">‚ú¶</div>

<div class="card">
    <div class="card-banner">
        <div class="bb bb1"></div>
        <div class="bb bb2"></div>
        <div class="profile-area">
            <div class="avatar-ring">ü¶â</div>
            <div class="welcome-lbl">üéâ Welcome Back!</div>
            <div class="student-name" id="studentNameEl">{{ session.get('name', 'Student') }}</div>
            <div class="id-chips">
                <span class="id-chip">üìö Roll No: {{ session.get('roll_no', '‚Äî') }}</span>
                <span class="id-chip">üè´ Class {{ session.get('class_name', '‚Äî') }}-{{ session.get('division', '‚Äî') }}</span>
                <span class="id-chip gold">ü™™ {{ session.get('user_id_code', '‚Äî') }}</span>
            </div>
        </div>
    </div>

    <div class="card-body">
        <div class="stats-row">
            <div class="stat-box"><div class="stat-icon">‚ö°</div><div class="stat-val" id="statXP">‚Ä¶</div><div class="stat-lbl">XP Earned</div></div>
            <div class="stat-box"><div class="stat-icon">üèÜ</div><div class="stat-val" id="statLevel">‚Ä¶</div><div class="stat-lbl">Level</div></div>
            <div class="stat-box"><div class="stat-icon">‚≠ê</div><div class="stat-val" id="statStars">‚Ä¶</div><div class="stat-lbl">Stars</div></div>
            <div class="stat-box"><div class="stat-icon">üî•</div><div class="stat-val" id="statStreak">‚Ä¶</div><div class="stat-lbl">Streak</div></div>
        </div>

        <div id="dailyBannerWrap"></div>

        <div class="quote-box">
            <div class="quote-text" id="quoteText">"The expert in anything was once a beginner."</div>
            <div class="quote-author" id="quoteAuthor">‚Äî Helen Hayes</div>
        </div>

        <div class="actions-grid">
            <a href="/main" class="btn btn-start">üöÄ Start Learning</a>
            <button onclick="openProgressModal()" class="btn btn-progress">üìä My Progress</button>
            <a href="/logout" class="btn btn-logout">üö™ Logout</a>
        </div>

        <div class="danger-zone">
            <div>
                <div class="danger-label">‚ö†Ô∏è Danger Zone</div>
                <div class="danger-sub">Permanently delete your account and all data</div>
            </div>
            <button class="btn-delete" onclick="showDeleteModal()">üóëÔ∏è Delete Account</button>
        </div>
    </div>
</div>


<!-- ‚ïê‚ïê PROGRESS MODAL ‚ïê‚ïê -->
<div class="modal" id="progressModal">
    <div class="modal-box-lg">
        <button class="modal-close" onclick="closeProgressModal()">‚úï</button>
        <div class="prog-title">üìä My Progress</div>

        <!-- Tab bar -->
        <div class="modal-tabs">
            <button class="tab-btn active" onclick="switchTab('overview', this)">üìà Overview</button>
            <button class="tab-btn" onclick="switchTab('tracker', this)">üîç Mistake Tracker</button>
            <button class="tab-btn" onclick="switchTab('suggestions', this)">üí° My Tips</button>
        </div>

        <!-- Overview tab -->
        <div class="tab-pane active" id="tab-overview">
            <div id="overviewContent">
                <div class="prog-loading"><div class="spin"></div><br>Loading‚Ä¶</div>
            </div>
        </div>

        <!-- Mistake Tracker tab -->
        <div class="tab-pane" id="tab-tracker">
            <div id="trackerContent">
                <div class="prog-loading"><div class="spin"></div><br>Loading tracker‚Ä¶</div>
            </div>
        </div>

        <!-- Suggestions tab -->
        <div class="tab-pane" id="tab-suggestions">
            <div id="suggestionsContent">
                <div class="prog-loading"><div class="spin"></div><br>Generating your tips‚Ä¶</div>
            </div>
        </div>
    </div>
</div>


<!-- ‚ïê‚ïê DELETE MODAL ‚ïê‚ïê -->
<div class="modal" id="deleteModal">
    <div class="modal-box-sm">
        <div class="modal-icon">‚ö†Ô∏è</div>
        <div class="modal-title">Delete Account?</div>
        <div class="modal-body">This will permanently erase your account and all your data, including:</div>
        <div class="modal-warn">
            ‚ùå All your XP and progress<br>
            ‚ùå All activity history<br>
            ‚ùå All badges earned<br>
            ‚ùå Your login credentials<br><br>
            <strong>This action CANNOT be undone!</strong>
        </div>
        <div class="modal-btns">
            <button class="mbtn mbtn-cancel" onclick="hideDeleteModal()">No, Keep Account</button>
            <button class="mbtn mbtn-danger" id="confirmDeleteBtn" onclick="confirmDelete()">Yes, Delete Forever</button>
        </div>
    </div>
</div>


<script>
// ‚îÄ‚îÄ Capitalize helper ‚îÄ‚îÄ
function cap(str) {
    return (str || '').split(' ').map(function(w) {
        return w ? w[0].toUpperCase() + w.slice(1).toLowerCase() : w;
    }).join(' ');
}

// ‚îÄ‚îÄ Quotes ‚îÄ‚îÄ
var QUOTES = [
    { text:"The beautiful thing about learning is that no one can take it away from you.", author:"B.B. King" },
    { text:"Education is the most powerful weapon you can use to change the world.", author:"Nelson Mandela" },
    { text:"The expert in anything was once a beginner.", author:"Helen Hayes" },
    { text:"Learning never exhausts the mind.", author:"Leonardo da Vinci" },
    { text:"The more that you read, the more things you will know.", author:"Dr. Seuss" },
    { text:"Success is the sum of small efforts repeated day in and day out.", author:"Robert Collier" },
    { text:"Every day is a chance to learn something new!", author:"Unknown" },
    { text:"You are doing amazing! Keep going!", author:"Your Teacher" }
];

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
window.addEventListener('DOMContentLoaded', function () {
    var nameEl = document.getElementById('studentNameEl');
    if (nameEl) nameEl.textContent = cap(nameEl.textContent.trim());

    var q = QUOTES[Math.floor(Math.random() * QUOTES.length)];
    document.getElementById('quoteText').textContent   = '\u201c' + q.text + '\u201d';
    document.getElementById('quoteAuthor').textContent = '\u2014 ' + q.author;

    loadDashboard();
});

// ‚îÄ‚îÄ Cache ‚îÄ‚îÄ
var _sd  = null;   // student info
var _det = null;   // progress details (tracker + suggestions)

function fetchStudentInfo() {
    return fetch('/get_student_info')
        .then(function(r) { return r.json(); })
        .then(function(j) {
            if (!j.success) throw new Error(j.message || 'Error');
            _sd = j.student;
            return _sd;
        });
}

function fetchProgressDetails() {
    return fetch('/get_progress_details')
        .then(function(r) { return r.json(); })
        .then(function(j) {
            if (!j.success) throw new Error(j.message || 'Error');
            _det = j;
            return _det;
        });
}

// ‚îÄ‚îÄ Load stat tiles + daily banner ‚îÄ‚îÄ
function loadDashboard() {
    fetchStudentInfo().then(function(s) {
        var xp    = s.xp || 0;
        var level = Math.floor(xp / 100) + 1;
        document.getElementById('statXP').textContent     = xp;
        document.getElementById('statLevel').textContent  = level;
        document.getElementById('statStars').textContent  = s.totalStars || 0;
        document.getElementById('statStreak').textContent = (s.streak || 0) + 'd';
        renderDailyBanner(s.dailyChallenge, s.dailyCompleted);
    }).catch(function(e) {
        console.error('Dashboard load failed:', e);
        ['statXP','statLevel','statStars','statStreak'].forEach(function(id) {
            var el = document.getElementById(id);
            if (el && el.textContent === '‚Ä¶') el.textContent = '‚Äî';
        });
    });
}

// ‚îÄ‚îÄ Daily banner ‚îÄ‚îÄ
function renderDailyBanner(challenge, completed) {
    var wrap = document.getElementById('dailyBannerWrap');
    if (!challenge) return;
    if (completed) {
        wrap.innerHTML =
            '<div class="daily-dash-banner done">' +
            '<span class="ddb-icon">‚úÖ</span>' +
            '<div class="ddb-text"><div class="ddb-title">Daily Challenge Completed!</div>' +
            '<div class="ddb-sub">Great work! Come back tomorrow for a new challenge.</div></div>' +
            '<span class="ddb-xp">+3 XP ‚úì</span></div>';
    } else {
        wrap.innerHTML =
            '<a href="/main" class="daily-dash-banner">' +
            '<span class="ddb-icon">üåü</span>' +
            '<div class="ddb-text"><div class="ddb-title">üìÖ Today\'s Daily Challenge</div>' +
            '<div class="ddb-sub">Word: <strong>' + (challenge.word || '').toUpperCase() + '</strong> &middot; Tap to practice!</div></div>' +
            '<span class="ddb-xp">+3 XP</span></a>';
    }
}

// ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ
function switchTab(tabId, btn) {
    document.querySelectorAll('.tab-pane').forEach(function(p) { p.classList.remove('active'); });
    document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
    document.getElementById('tab-' + tabId).classList.add('active');
    btn.classList.add('active');
}

// ‚îÄ‚îÄ Progress modal ‚îÄ‚îÄ
function openProgressModal() {
    document.getElementById('progressModal').classList.add('active');
    // Reset tabs to Overview
    switchTab('overview', document.querySelectorAll('.tab-btn')[0]);

    // Show spinners
    document.getElementById('overviewContent').innerHTML    = '<div class="prog-loading"><div class="spin"></div><br>Loading‚Ä¶</div>';
    document.getElementById('trackerContent').innerHTML     = '<div class="prog-loading"><div class="spin"></div><br>Loading tracker‚Ä¶</div>';
    document.getElementById('suggestionsContent').innerHTML = '<div class="prog-loading"><div class="spin"></div><br>Generating your tips‚Ä¶</div>';

    _sd  = null;
    _det = null;

    // Fetch both in parallel
    Promise.all([fetchStudentInfo(), fetchProgressDetails()])
        .then(function(results) {
            renderProgress(results[0]);
            renderTracker(results[1]);
            renderSuggestions(results[1].suggestions || []);
        })
        .catch(function() {
            var errMsg = '<div class="prog-loading" style="color:#e74c3c;">Failed to load. Please try again.</div>';
            document.getElementById('overviewContent').innerHTML    = errMsg;
            document.getElementById('trackerContent').innerHTML     = errMsg;
            document.getElementById('suggestionsContent').innerHTML = errMsg;
        });
}

function closeProgressModal() {
    document.getElementById('progressModal').classList.remove('active');
}

// ‚îÄ‚îÄ Render Overview ‚îÄ‚îÄ
function renderProgress(s) {
    var xp        = s.xp || 0;
    var level     = Math.floor(xp / 100) + 1;
    var xpInLevel = xp % 100;
    var xpToNext  = 100 - xpInLevel;

    var modes = [
        { label:'Conversation', icon:'üí¨', key:'conversationXp'  },
        { label:'Roleplay',     icon:'üé≠', key:'roleplayXp'      },
        { label:'Repeat',       icon:'üîÅ', key:'repeatXp'        },
        { label:'Spell Bee',    icon:'üêù', key:'spellbeeXp'      },
        { label:'Word Puzzle',  icon:'üß©', key:'wordpuzzleXp'    },
        { label:'Grammar',      icon:'üìù', key:'grammarXp'       },
        { label:'Meanings üéÅ',  icon:'üìñ', key:'meaningsXp'      },
    ];

    var barsHTML = modes.map(function(m) {
        var val = s[m.key] || 0;
        var pct = xp > 0 ? Math.min(Math.round((val / xp) * 100), 100) : 0;
        return '<div class="xp-bar-row">' +
            '<div class="xp-bar-top">' +
            '<span class="xp-bar-label">' + m.icon + ' ' + m.label + '</span>' +
            '<span class="xp-bar-val">' + val + ' XP</span>' +
            '</div><div class="xp-bar-track">' +
            '<div class="xp-bar-fill" style="width:' + pct + '%"></div>' +
            '</div></div>';
    }).join('');

    var features = [
        { key:'conversation', label:'üí¨ Conversation', bonus:false },
        { key:'roleplay',     label:'üé≠ Roleplay',     bonus:false },
        { key:'repeat',       label:'üîÅ Repeat',       bonus:false },
        { key:'spellbee',     label:'üêù Spell Bee',    bonus:false },
        { key:'wordpuzzle',   label:'üß© Word Puzzle',  bonus:false },
        { key:'grammar',      label:'üìù Grammar',      bonus:false },
        { key:'meanings',     label:'üìñ Meanings',     bonus:true  },
    ];
    var unlocked = s.unlockedFeatures || ['conversation'];
    var pillsHTML = features.map(function(f) {
        var on   = unlocked.indexOf(f.key) !== -1;
        var cls  = on ? (f.bonus ? 'feat-bonus' : 'feat-unlocked') : 'feat-locked';
        var icon = on ? (f.bonus ? 'üéÅ' : '‚úÖ') : 'üîí';
        return '<span class="feat-pill ' + cls + '">' + icon + ' ' + f.label + '</span>';
    }).join('');

    var fNames = { roleplay:'Roleplay', repeat:'Repeat', spellbee:'Spell Bee', wordpuzzle:'Word Puzzle', grammar:'Grammar', meanings:'üìñ Meanings (Bonus)' };
    var mNames = { conversation:'Conversation', roleplay:'Roleplay', repeat:'Repeat', spellbee:'Spell Bee', wordpuzzle:'Word Puzzle', grammar:'Grammar' };
    var nuHTML = '';
    if (s.nextUnlock) {
        var nu = s.nextUnlock;
        nuHTML = '<div class="next-unlock-box">üîì Next Unlock: <strong>' +
            (fNames[nu.feature] || nu.feature) + '</strong>' +
            ' &nbsp;¬∑&nbsp; Earn <strong>' + nu.xp_needed + ' more XP</strong> in ' +
            (mNames[nu.current_mode] || nu.current_mode) + '</div>';
    } else {
        nuHTML = '<div class="next-unlock-box">üéâ <strong>All features unlocked ‚Äî including the bonus!</strong> You\'re a champion! üèÜ</div>';
    }

    function pStat(icon, val, lbl) {
        return '<div class="prog-stat"><div class="ps-icon">' + icon + '</div>' +
            '<div class="ps-val">' + val + '</div>' +
            '<div class="ps-lbl">' + lbl + '</div></div>';
    }

    document.getElementById('overviewContent').innerHTML =
        '<div class="prog-stats">' +
        pStat('‚ö°', xp, 'Total XP') +
        pStat('üèÜ', 'Lv ' + level, 'Level') +
        pStat('‚≠ê', s.totalStars || 0, 'Stars') +
        pStat('üéØ', (s.averageAccuracy || 0) + '%', 'Accuracy') +
        pStat('üî•', (s.streak || 0) + 'd', 'Streak') +
        pStat('üèÖ', (s.earnedBadgeCount || 0) + '/' + (s.totalBadgeCount || 0), 'Badges') +
        '</div>' +

        '<div class="xp-section" style="margin-bottom:18px;">' +
        '<div class="xp-bar-top" style="margin-bottom:6px;">' +
        '<span class="xp-bar-label">‚ö° Level ' + level + ' Progress</span>' +
        '<span class="xp-bar-val">' + xpToNext + ' XP to Level ' + (level+1) + '</span>' +
        '</div><div class="xp-bar-track" style="height:14px;">' +
        '<div class="xp-bar-fill green" style="width:' + xpInLevel + '%"></div>' +
        '</div></div>' +

        nuHTML +

        '<div class="xp-section"><h3>XP by Mode</h3>' + barsHTML + '</div>' +
        '<div class="unlock-section"><h3>Unlocked Features</h3>' +
        '<div class="feature-pills">' + pillsHTML + '</div></div>';
}

// ‚îÄ‚îÄ Render Tracker ‚îÄ‚îÄ
var MODE_LABELS = {
    conversation: { label: 'Conversation', icon: 'üí¨' },
    roleplay:     { label: 'Roleplay',     icon: 'üé≠' },
    repeat:       { label: 'Repeat',       icon: 'üîÅ' },
    spellbee:     { label: 'Spell Bee',    icon: 'üêù' },
    wordpuzzle:   { label: 'Word Puzzle',  icon: 'üß©' },
    grammar:      { label: 'Grammar',      icon: 'üìù' },
    meanings:     { label: 'Meanings',     icon: 'üìñ' },
};

function modeLabel(mode) {
    return (MODE_LABELS[mode] && MODE_LABELS[mode].label) || (mode.charAt(0).toUpperCase() + mode.slice(1));
}
function modeIcon(mode) {
    return (MODE_LABELS[mode] && MODE_LABELS[mode].icon) || 'üìå';
}

function renderTracker(det) {
    var modeStats     = det.modeStats || {};
    var weakSessions  = det.weakSessions || [];
    var recentSessions= det.recentSessions || [];

    var allModes = ['conversation','roleplay','repeat','spellbee','wordpuzzle','grammar','meanings'];

    // ‚îÄ‚îÄ Mode score cards ‚îÄ‚îÄ
    var modeCardsHTML = '<div class="mode-grid">';
    allModes.forEach(function(mode) {
        var stats = modeStats[mode];
        var icon  = modeIcon(mode);
        var label = modeLabel(mode);
        if (!stats || stats.totalAttempts === 0) {
            modeCardsHTML +=
                '<div class="mode-card untried">' +
                '<span class="mc-icon">' + icon + '</span>' +
                '<div class="mc-body">' +
                '<div class="mc-label">' + label + '</div>' +
                '<div class="mc-score">No attempts yet</div>' +
                '<span class="mc-badge badge-untried">Not Tried</span>' +
                '<div class="mc-bar-track"><div class="mc-bar-fill fill-untried" style="width:0%"></div></div>' +
                '</div></div>';
        } else {
            var avg = stats.avgScore;
            var cls, fillCls, badgeCls, badgeLabel;
            if (avg >= 75) {
                cls = 'strong'; fillCls = 'fill-strong'; badgeCls = 'badge-strong'; badgeLabel = 'Strong ‚úì';
            } else if (avg >= 60) {
                cls = 'improving'; fillCls = 'fill-improve'; badgeCls = 'badge-improve'; badgeLabel = 'Improving ‚Üë';
            } else {
                cls = 'struggling'; fillCls = 'fill-struggle'; badgeCls = 'badge-struggle'; badgeLabel = 'Needs Work ‚ö†';
            }
            modeCardsHTML +=
                '<div class="mode-card ' + cls + '">' +
                '<span class="mc-icon">' + icon + '</span>' +
                '<div class="mc-body">' +
                '<div class="mc-label">' + label + '</div>' +
                '<div class="mc-score">' + stats.totalAttempts + ' sessions ¬∑ ' + stats.totalStars + ' ‚≠ê</div>' +
                '<span class="mc-badge ' + badgeCls + '">' + badgeLabel + '</span>' +
                '<div class="mc-bar-track">' +
                '<div class="mc-bar-fill ' + fillCls + '" style="width:' + Math.min(avg,100) + '%"></div>' +
                '</div>' +
                '<div style="font-size:11px;font-weight:800;color:var(--muted);margin-top:3px;">' + avg.toFixed(0) + '% avg</div>' +
                '</div></div>';
        }
    });
    modeCardsHTML += '</div>';

    // ‚îÄ‚îÄ Weak sessions ‚îÄ‚îÄ
    var weakHTML = '';
    if (weakSessions.length === 0) {
        weakHTML = '<div class="no-data-msg">üéâ No low-score sessions! You\'re doing great in all modes.</div>';
    } else {
        weakHTML = '<div class="weak-list">';
        weakSessions.forEach(function(ws) {
            var d = ws.date ? ws.date.split('T')[0] : '‚Äî';
            weakHTML +=
                '<div class="weak-item">' +
                '<div><div class="wi-mode">' + modeIcon(ws.mode) + ' ' + modeLabel(ws.mode) + '</div>' +
                '<div class="wi-date">' + d + '</div></div>' +
                '<span class="wi-score">' + ws.score.toFixed(0) + '%</span>' +
                '</div>';
        });
        weakHTML += '</div>';
    }

    // ‚îÄ‚îÄ Recent sessions ‚îÄ‚îÄ
    var recentHTML = '';
    if (recentSessions.length === 0) {
        recentHTML = '<div class="no-data-msg">No sessions recorded yet. Start practicing to see your history!</div>';
    } else {
        recentHTML = '<div class="recent-list">';
        recentSessions.forEach(function(rs) {
            var d = rs.date ? rs.date.split('T')[0] : '‚Äî';
            var scoreCls = rs.score >= 80 ? 'score-great' : (rs.score >= 60 ? 'score-ok' : 'score-low');
            recentHTML +=
                '<div class="recent-item">' +
                '<div class="ri-left">' +
                '<span style="font-size:18px;">' + modeIcon(rs.mode) + '</span>' +
                '<div><div class="ri-mode">' + modeLabel(rs.mode) + '</div>' +
                '<div class="ri-date">' + d + '</div></div></div>' +
                '<div class="ri-right">' +
                '<span class="ri-score ' + scoreCls + '">' + rs.score.toFixed(0) + '%</span>' +
                '<span class="ri-xp">+' + (rs.xpEarned || 0) + ' XP</span>' +
                '</div></div>';
        });
        recentHTML += '</div>';
    }

    document.getElementById('trackerContent').innerHTML =
        '<div class="tracker-section">' +
        '<h3>üìä Performance by Mode</h3>' +
        modeCardsHTML +
        '</div>' +
        '<div class="tracker-section">' +
        '<h3>‚ö†Ô∏è Recent Low-Score Sessions (below 70%)</h3>' +
        weakHTML +
        '</div>' +
        '<div class="tracker-section">' +
        '<h3>üïê Recent Activity</h3>' +
        recentHTML +
        '</div>';
}

// ‚îÄ‚îÄ Render Suggestions ‚îÄ‚îÄ
var SugTypeClass = {
    struggle:  'sug-struggle',
    improve:   'sug-improve',
    praise:    'sug-praise',
    streak:    'sug-streak',
    explore:   'sug-explore',
    retry:     'sug-retry',
    milestone: 'sug-milestone',
    stars:     'sug-stars',
    info:      'sug-info',
};

function renderSuggestions(suggestions) {
    if (!suggestions || suggestions.length === 0) {
        document.getElementById('suggestionsContent').innerHTML =
            '<div class="no-data-msg">üéâ Keep practicing to get personalised tips here!</div>';
        return;
    }

    var html = '<div class="suggestion-list">';
    suggestions.forEach(function(sug, i) {
        var cardClass = SugTypeClass[sug.type] || 'sug-info';
        var actionBtn = '';
        if (sug.action && sug.action_link) {
            actionBtn = '<a href="' + sug.action_link + '" class="sug-action">' + sug.action + ' ‚Üí</a>';
        }
        html +=
            '<div class="suggestion-card ' + cardClass + '" style="animation-delay:' + (i * 0.07) + 's">' +
            '<span class="sug-icon">' + sug.icon + '</span>' +
            '<div class="sug-body">' +
            '<div class="sug-title">' + sug.title + '</div>' +
            '<div class="sug-msg">' + sug.message + '</div>' +
            actionBtn +
            '</div></div>';
    });
    html += '</div>';

    document.getElementById('suggestionsContent').innerHTML = html;
}

// ‚îÄ‚îÄ Delete ‚îÄ‚îÄ
function showDeleteModal() { document.getElementById('deleteModal').classList.add('active'); }
function hideDeleteModal() { document.getElementById('deleteModal').classList.remove('active'); }

function confirmDelete() {
    var btn = document.getElementById('confirmDeleteBtn');
    btn.disabled = true; btn.textContent = 'Deleting‚Ä¶';
    fetch('/delete_account', { method:'POST', headers:{'Content-Type':'application/json'} })
        .then(function(r) { return r.json(); })
        .then(function(d) {
            if (d.success) { alert(d.message); window.location.href = '/login'; }
            else { alert('Error: ' + d.message); btn.disabled = false; btn.textContent = 'Yes, Delete Forever'; }
        }).catch(function() {
            alert('An error occurred. Please try again.');
            btn.disabled = false; btn.textContent = 'Yes, Delete Forever';
        });
}

// ‚îÄ‚îÄ Outside-click & ESC to close modals ‚îÄ‚îÄ
['deleteModal','progressModal'].forEach(function(id) {
    document.getElementById(id).addEventListener('click', function(e) {
        if (e.target === this) { hideDeleteModal(); closeProgressModal(); }
    });
});
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') { hideDeleteModal(); closeProgressModal(); }
});
</script>
</body>
</html>