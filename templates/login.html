<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gayathri Speak Smart ‚Äì Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --purple: #667eea;
            --purple-dark: #764ba2;
            --green: #00b894;
            --teal: #00cec9;
            --white: #ffffff;
            --bg: #f0f2ff;
            --card: #ffffff;
            --text: #2d3436;
            --muted: #636e72;
            --border: #e0e4ff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #6b6fc5 0%, #7b5ea7 40%, #9b6bbf 70%, #b07fd4 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .bg-blob { position:fixed; border-radius:50%; pointer-events:none; animation:blobFloat 18s ease-in-out infinite; }
        .blob1 { width:520px;height:520px;background:rgba(255,255,255,.07);bottom:-180px;right:-160px;animation-delay:0s; }
        .blob2 { width:380px;height:380px;background:rgba(255,255,255,.07);top:-120px;left:-120px;animation-delay:6s; }
        .blob3 { width:180px;height:180px;background:rgba(255,255,255,.06);top:45%;right:5%;animation-delay:10s; }
        .blob4 { width:120px;height:120px;background:rgba(255,255,255,.05);bottom:15%;left:6%;animation-delay:3s; }
        @keyframes blobFloat { 0%,100%{transform:translateY(0) scale(1);} 50%{transform:translateY(-30px) scale(1.05);} }

        .deco-star { position:fixed; pointer-events:none; color:rgba(255,255,255,.5); animation:starTwinkle 4s ease-in-out infinite; }
        @keyframes starTwinkle { 0%,100%{opacity:.25;transform:scale(1) rotate(0deg);} 50%{opacity:.6;transform:scale(1.25) rotate(20deg);} }

        .card {
            background:var(--card); border-radius:30px; padding:36px 40px 32px;
            width:100%; max-width:460px;
            box-shadow:0 24px 80px rgba(102,126,234,.18),0 4px 16px rgba(0,0,0,.06);
            position:relative; z-index:10;
            animation:cardPop .6s cubic-bezier(.34,1.56,.64,1) both;
        }
        @media (max-height: 700px) {
            body { align-items: flex-start; }
            .card { margin: 0 auto; }
        }
        @keyframes cardPop { from{transform:scale(.88) translateY(24px);opacity:0;} to{transform:scale(1) translateY(0);opacity:1;} }

        .header { text-align:center; margin-bottom:20px; }
        .mascot-wrap {
            display:inline-flex; align-items:center; justify-content:center;
            width:70px; height:70px;
            background:linear-gradient(135deg,var(--purple),var(--purple-dark));
            border-radius:24px; font-size:38px; margin-bottom:10px;
            box-shadow:0 10px 30px rgba(102,126,234,.4);
            animation:owlBounce 2.4s ease-in-out infinite;
        }
        @keyframes owlBounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }
        .app-title {
            font-family:'Fredoka One',cursive; font-size:24px;
            background:linear-gradient(135deg,var(--purple),var(--purple-dark));
            -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
        }
        .app-sub { color:var(--muted); font-size:13px; font-weight:600; margin-top:3px; }

        .role-tabs { display:flex; background:var(--bg); border-radius:14px; padding:5px; margin-bottom:20px; gap:4px; }
        .role-tab {
            flex:1; padding:10px; border:none; border-radius:10px; background:transparent;
            font-family:'Nunito',sans-serif; font-size:15px; font-weight:700;
            color:var(--muted); cursor:pointer; transition:all .25s;
        }
        .role-tab.active { background:white; color:var(--purple-dark); box-shadow:0 4px 12px rgba(102,126,234,.2); }

        .panel { display:none; animation:fadeSlide .35s ease both; }
        .panel.active { display:block; }
        @keyframes fadeSlide { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }

        .form-group { margin-bottom:13px; }
        .form-label {
            display:block; font-size:11px; font-weight:800; color:var(--text);
            margin-bottom:6px; text-transform:uppercase; letter-spacing:.5px;
        }
        .input-wrap { position:relative; display:flex; align-items:center; }
        .input-icon { position:absolute; left:14px; font-size:16px; pointer-events:none; }
        .form-input {
            width:100%; padding:11px 14px 11px 42px;
            border:2.5px solid var(--border); border-radius:12px;
            font-family:'Nunito',sans-serif; font-size:14px; font-weight:600;
            color:var(--text); background:var(--bg); outline:none; transition:all .2s;
        }
        .form-input:focus { border-color:var(--purple); background:white; box-shadow:0 0 0 4px rgba(102,126,234,.12); }
        .form-input::placeholder { color:#b2bec3; font-weight:600; }

        .uid-input {
            font-family: 'Courier New', Courier, monospace;
            font-size: 17px;
            font-weight: 800;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--purple-dark);
        }

        select.form-input {
            cursor:pointer;
            background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='7' viewBox='0 0 11 7'%3E%3Cpath fill='%23667eea' d='M.5.5l5 5 5-5'/%3E%3C/svg%3E");
            background-repeat:no-repeat; background-position:right 14px center;
            -webkit-appearance:none; appearance:none;
        }

        .two-col { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

        .btn {
            width:100%; padding:13px; border:none; border-radius:14px;
            font-family:'Nunito',sans-serif; font-size:16px; font-weight:800;
            cursor:pointer; transition:all .25s; position:relative; overflow:hidden;
        }
        .btn::after { content:''; position:absolute; inset:0; background:rgba(255,255,255,0); transition:background .2s; }
        .btn:hover::after { background:rgba(255,255,255,.12); }
        .btn:active { transform:scale(.97); }
        .btn:disabled { opacity:.65; cursor:not-allowed; transform:none !important; }

        .btn-primary { background:linear-gradient(135deg,var(--purple),var(--purple-dark)); color:white; box-shadow:0 8px 24px rgba(102,126,234,.4); margin-top:4px; }
        .btn-primary:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 12px 30px rgba(102,126,234,.5); }

        .btn-green { background:linear-gradient(135deg,var(--green),var(--teal)); color:white; box-shadow:0 8px 24px rgba(0,184,148,.35); margin-top:4px; }
        .btn-green:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 12px 30px rgba(0,184,148,.45); }

        .btn-outline { background:transparent; color:var(--purple); border:2.5px solid var(--border); font-size:14px; padding:11px; margin-top:4px; }
        .btn-outline:hover { border-color:var(--purple); background:rgba(102,126,234,.06); }

        .forgot-link {
            display:block; text-align:right; font-size:13px; font-weight:700;
            color:var(--purple); cursor:pointer; margin-top:-4px; margin-bottom:12px; transition:color .2s;
        }
        .forgot-link:hover { color:var(--purple-dark); text-decoration:underline; }

        .alert {
            padding:11px 14px; border-radius:12px; font-size:13px; font-weight:700;
            margin-bottom:13px; display:none; align-items:center; gap:10px;
            animation:fadeSlide .3s ease both;
        }
        .alert.show { display:flex; }
        .alert-success { background:#d4f5ee; color:#00796b; border:2px solid #80cbc4; }
        .alert-error   { background:#fde8e8; color:#c0392b; border:2px solid #f5a5a5; }

        .divider { display:flex; align-items:center; gap:12px; margin:14px 0 10px; color:var(--muted); font-size:13px; font-weight:700; }
        .divider::before,.divider::after { content:''; flex:1; height:2px; background:var(--border); border-radius:1px; }

        .info-note {
            background:linear-gradient(135deg,#f0eeff,#e8f4fd);
            border:2px solid #c5b8fe; border-radius:12px;
            padding:10px 13px; margin-bottom:13px;
            font-size:12px; color:#4a4a8a; line-height:1.5; font-weight:600;
        }
        .info-note strong { color:var(--purple); }

        .uid-reveal {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 16px;
            padding: 18px 20px;
            text-align: center;
            margin-bottom: 14px;
            display: none;
            animation: fadeSlide .4s ease both;
        }
        .uid-reveal.show { display: block; }
        .uid-reveal-label { font-size: 12px; font-weight: 800; color: rgba(255,255,255,.75); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .uid-reveal-code  { font-family: 'Courier New', monospace; font-size: 28px; font-weight: 900; color: #fff; letter-spacing: 6px; margin-bottom: 10px; text-shadow: 0 2px 12px rgba(0,0,0,.3); }
        .uid-reveal-note  { font-size: 12px; color: rgba(255,255,255,.8); font-weight: 600; line-height: 1.5; }
        .uid-copy-btn {
            background: rgba(255,255,255,.2); color: white; border: 2px solid rgba(255,255,255,.4);
            border-radius: 8px; padding: 6px 16px; font-size: 13px; font-weight: 800;
            cursor: pointer; margin-top: 10px; transition: background .2s;
            font-family: 'Nunito', sans-serif;
        }
        .uid-copy-btn:hover { background: rgba(255,255,255,.35); }

        .pw-strength-bar { height:5px; border-radius:3px; background:var(--border); margin-top:7px; overflow:hidden; }
        .pw-strength-fill { height:100%; border-radius:3px; width:0%; transition:width .4s,background .4s; }
        .pw-strength-label { font-size:12px; font-weight:700; margin-top:3px; height:16px; }

        .spinner {
            display:inline-block; width:17px; height:17px;
            border:3px solid rgba(255,255,255,.4); border-top-color:white;
            border-radius:50%; animation:spin .7s linear infinite;
            vertical-align:middle; margin-right:8px;
        }
        @keyframes spin { to{transform:rotate(360deg);} }

        /* ‚îÄ‚îÄ Forgot Password Modal ‚îÄ‚îÄ */
        .modal-overlay {
            display:none; position:fixed; inset:0;
            background:rgba(20,20,40,.6); z-index:1000;
            backdrop-filter:blur(6px);
            align-items:center; justify-content:center; padding:20px;
            overflow-y: auto;
        }
        .modal-overlay.open { display:flex; }
        .modal-box {
            background:white; border-radius:28px; padding:34px 30px;
            width:100%; max-width:440px;
            box-shadow:0 30px 80px rgba(0,0,0,.3);
            animation:cardPop .4s cubic-bezier(.34,1.56,.64,1) both;
            position:relative;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            margin: auto;
        }
        .modal-close {
            position:absolute; top:14px; right:16px;
            width:34px; height:34px; border-radius:50%; border:none;
            background:#f5f5f5; font-size:18px; cursor:pointer;
            display:flex; align-items:center; justify-content:center; transition:background .2s;
        }
        .modal-close:hover { background:#ffe0e0; }
        .modal-icon  { text-align:center; font-size:48px; margin-bottom:8px; }
        .modal-title { font-family:'Fredoka One',cursive; font-size:21px; color:var(--purple-dark); text-align:center; margin-bottom:5px; }
        .modal-desc  { text-align:center; color:var(--muted); font-size:13px; font-weight:600; margin-bottom:18px; line-height:1.5; }

        .steps { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:18px; }
        .step-dot { width:10px; height:10px; border-radius:50%; background:var(--border); transition:all .3s; }
        .step-dot.active { background:var(--purple); transform:scale(1.3); }
        .step-dot.done   { background:var(--green); }
        .step-panel { display:none; }
        .step-panel.active { display:block; animation:fadeSlide .3s ease both; }

        .modal-section-label {
            font-size:11px; font-weight:900; text-transform:uppercase; letter-spacing:.8px;
            color:var(--purple); background:linear-gradient(135deg,#f0eeff,#e8f4fd);
            border:1.5px solid #c5b8fe; border-radius:8px;
            padding:6px 12px; margin:14px 0 10px; display:flex; align-items:center; gap:6px;
        }

        .success-check { text-align:center; padding:8px 0 16px; }
        .check-circle {
            width:80px; height:80px; border-radius:50%;
            background:linear-gradient(135deg,var(--green),var(--teal));
            display:inline-flex; align-items:center; justify-content:center;
            font-size:38px; margin-bottom:14px;
            box-shadow:0 10px 30px rgba(0,184,148,.4);
            animation:popIn .5s cubic-bezier(.34,1.56,.64,1) both;
        }
        @keyframes popIn { from{transform:scale(0);opacity:0;} to{transform:scale(1);opacity:1;} }
        .success-title { font-family:'Fredoka One',cursive; font-size:22px; color:var(--green); margin-bottom:8px; }
        .success-msg   { color:var(--muted); font-size:14px; font-weight:600; line-height:1.5; }

        @media(max-width:480px) {
            body { padding: 12px; }
            .card { padding:28px 16px 24px; border-radius:22px; }
            .modal-box { padding:26px 16px; }
            .two-col { grid-template-columns:1fr; }
            .app-title { font-size:22px; }
        }
        @media(max-height:600px) {
            body { padding: 10px; align-items: flex-start; }
            .card { padding: 20px 24px 18px; }
            .mascot-wrap { width:52px; height:52px; font-size:28px; margin-bottom:6px; }
            .app-title { font-size:20px; }
            .app-sub { display:none; }
            .header { margin-bottom:12px; }
            .role-tabs { margin-bottom:14px; }
            .form-group { margin-bottom:9px; }
            .form-input { padding:9px 12px 9px 38px; font-size:13px; }
            .divider { margin:10px 0 8px; }
            .btn { padding:11px; font-size:14px; }
        }
    </style>
</head>
<body>

<div class="bg-blob blob1"></div>
<div class="bg-blob blob2"></div>
<div class="bg-blob blob3"></div>
<div class="bg-blob blob4"></div>
<div class="deco-star" style="top:12%;left:18%;font-size:20px;animation-delay:0s;">‚òÖ</div>
<div class="deco-star" style="top:8%;right:22%;font-size:16px;animation-delay:1s;">‚ú¶</div>
<div class="deco-star" style="bottom:20%;left:15%;font-size:24px;animation-delay:2s;">‚òÖ</div>
<div class="deco-star" style="bottom:30%;right:18%;font-size:14px;animation-delay:.5s;">‚ú¶</div>
<div class="deco-star" style="top:50%;left:8%;font-size:18px;animation-delay:1.8s;">‚úß</div>
<div class="deco-star" style="top:35%;right:8%;font-size:28px;animation-delay:3s;">‚åí</div>

<!-- ===================== MAIN CARD ===================== -->
<div class="card">
    <div class="header">
        <div class="mascot-wrap">ü¶â</div>
        <div class="app-title">Gayathri Speak Smart</div>
        <div class="app-sub">‚ú® Learn English the fun way!</div>
    </div>

    <div class="role-tabs">
        <button class="role-tab active" onclick="switchRole('student', this)">üéí Student</button>
        <button class="role-tab"        onclick="switchRole('teacher', this)">üë©‚Äçüè´ Teacher</button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STUDENT PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="panel active" id="studentPanel">

        <div id="studentLogin">
            <div class="alert alert-error" id="studentLoginError">
                <span>‚ö†Ô∏è</span><span id="studentLoginErrorMsg"></span>
            </div>

            <div class="info-note">
                ü™™ Use your <strong>User ID</strong> (given when you registered, e.g. <strong>GSS-A3K7P</strong>) and your <strong>password</strong> to log in.
            </div>

            <div class="form-group">
                <label class="form-label">User ID</label>
                <div class="input-wrap">
                    <span class="input-icon">ü™™</span>
                    <input type="text" class="form-input uid-input" id="studentUserIdCode"
                           placeholder="GSS-XXXXX" maxlength="9" autocomplete="off"
                           oninput="this.value=this.value.toUpperCase()">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="input-wrap">
                    <span class="input-icon">üîë</span>
                    <input type="password" class="form-input" id="studentPassword" placeholder="Enter password"
                           autocomplete="current-password"
                           onkeypress="if(event.key==='Enter') loginStudent()">
                </div>
            </div>

            <a class="forgot-link" onclick="openForgotModal()">üîì Forgot password?</a>

            <button class="btn btn-primary" id="studentLoginBtn" onclick="loginStudent()">
                üöÄ Login to Learn!
            </button>
            <div class="divider">or</div>
            <button class="btn btn-outline" onclick="showStudentSignup()">‚úèÔ∏è Create New Account</button>
        </div>

        <div id="studentSignup" style="display:none;">
            <div class="alert alert-error"  id="studentSignupError"><span>‚ö†Ô∏è</span><span id="studentSignupErrorMsg"></span></div>

            <div class="uid-reveal" id="uidRevealBox">
                <div class="uid-reveal-label">üéâ Your Unique User ID</div>
                <div class="uid-reveal-code" id="uidRevealCode">GSS-XXXXX</div>
                <div class="uid-reveal-note">üìã Save this ID! You will need it every time you log in.</div>
                <button class="uid-copy-btn" onclick="copyUserId()">üìã Copy ID</button>
            </div>

            <div class="info-note">
                üìå <strong>Note:</strong> After you register, you'll get a unique <strong>User ID</strong> like <em>GSS-A3K7P</em>. Save it ‚Äî you'll use it to log in!
            </div>

            <div class="form-group">
                <label class="form-label">Full Name</label>
                <div class="input-wrap">
                    <span class="input-icon">üòä</span>
                    <input type="text" class="form-input" id="newStudentName" placeholder="Your full name">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Roll Number</label>
                <div class="input-wrap">
                    <span class="input-icon">üéí</span>
                    <input type="text" class="form-input" id="newStudentRollNo" placeholder="e.g. 12">
                </div>
            </div>

            <div class="two-col">
                <div class="form-group">
                    <label class="form-label">Class</label>
                    <div class="input-wrap">
                        <span class="input-icon">üè´</span>
                        <select class="form-input" id="newStudentClass" style="padding-left:40px;">
                            <option value="">Select</option>
                            <option value="1">Class 1</option><option value="2">Class 2</option>
                            <option value="3">Class 3</option><option value="4">Class 4</option>
                            <option value="5">Class 5</option><option value="6">Class 6</option>
                            <option value="7">Class 7</option><option value="8">Class 8</option>
                            <option value="9">Class 9</option><option value="10">Class 10</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Division</label>
                    <div class="input-wrap">
                        <span class="input-icon">üî§</span>
                        <select class="form-input" id="newStudentDivision" style="padding-left:40px;">
                            <option value="">Select</option>
                            <option value="A">A</option><option value="B">B</option>
                            <option value="C">C</option><option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="input-wrap">
                    <span class="input-icon">üîë</span>
                    <input type="password" class="form-input" id="newStudentPassword"
                           placeholder="Create a password" oninput="checkStrength(this.value)">
                </div>
                <div class="pw-strength-bar"><div class="pw-strength-fill" id="strengthFill"></div></div>
                <div class="pw-strength-label" id="strengthLabel"></div>
            </div>

            <button class="btn btn-green" id="studentSignupBtn" onclick="signupStudent()">
                üåü Create My Account!
            </button>
            <div class="divider">or</div>
            <button class="btn btn-outline" id="backToLoginBtn" onclick="showStudentLogin()">‚Üê Back to Login</button>
        </div>

    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TEACHER PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="panel" id="teacherPanel">

        <div id="teacherLogin">
            <div class="alert alert-error" id="teacherLoginError">
                <span>‚ö†Ô∏è</span><span id="teacherLoginErrorMsg"></span>
            </div>
            <div class="form-group">
                <label class="form-label">Email Address</label>
                <div class="input-wrap">
                    <span class="input-icon">üìß</span>
                    <input type="email" class="form-input" id="teacherEmail" placeholder="teacher@school.com" autocomplete="username">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="input-wrap">
                    <span class="input-icon">üîë</span>
                    <input type="password" class="form-input" id="teacherPassword" placeholder="Enter password"
                           autocomplete="current-password"
                           onkeypress="if(event.key==='Enter') loginTeacher()">
                </div>
            </div>
            <button class="btn btn-primary" id="teacherLoginBtn" onclick="loginTeacher()">
                üë©‚Äçüè´ Teacher Login
            </button>
            <div class="divider">or</div>
            <button class="btn btn-outline" onclick="showTeacherSignup()">‚úèÔ∏è Register as Teacher</button>
        </div>

        <div id="teacherSignup" style="display:none;">
            <div class="alert alert-error"  id="teacherSignupError"><span>‚ö†Ô∏è</span><span id="teacherSignupErrorMsg"></span></div>
            <div class="alert alert-success" id="teacherSignupSuccess"><span>üéâ</span><span>Account created! Please log in.</span></div>
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <div class="input-wrap">
                    <span class="input-icon">üë©‚Äçüè´</span>
                    <input type="text" class="form-input" id="newTeacherName" placeholder="Your name">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <div class="input-wrap">
                    <span class="input-icon">üìß</span>
                    <input type="email" class="form-input" id="newTeacherEmail" placeholder="teacher@school.com">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="input-wrap">
                    <span class="input-icon">üîë</span>
                    <input type="password" class="form-input" id="newTeacherPassword" placeholder="Create a password">
                </div>
            </div>
            <button class="btn btn-green" id="teacherSignupBtn" onclick="signupTeacher()">
                üåü Register
            </button>
            <div class="divider">or</div>
            <button class="btn btn-outline" onclick="showTeacherLogin()">‚Üê Back to Login</button>
        </div>

    </div>

    <!-- Admin link -->
    <div style="margin-top:22px; padding-top:16px; border-top:2px solid var(--border); text-align:center;">
        <a href="/admin/login"
           style="font-size:12px; font-weight:700; color:var(--muted); text-decoration:none;
                  display:inline-flex; align-items:center; gap:5px; letter-spacing:0.3px;
                  transition:color 0.2s;"
           onmouseover="this.style.color='#764ba2'"
           onmouseout="this.style.color='#636e72'">
            üõ°Ô∏è Administrator Login
        </a>
    </div>

</div><!-- /card -->

<!-- ===================== FORGOT PASSWORD MODAL ===================== -->
<div class="modal-overlay" id="forgotModal" onclick="closeForgotModalOutside(event)">
    <div class="modal-box" id="forgotBox">
        <button class="modal-close" onclick="closeForgotModal()" title="Close">√ó</button>

        <div class="steps">
            <div class="step-dot active" id="dot1"></div>
            <div class="step-dot"        id="dot2"></div>
            <div class="step-dot"        id="dot3"></div>
        </div>

        <div class="step-panel active" id="step1">
            <div class="modal-icon">üîì</div>
            <div class="modal-title">Forgot Password?</div>
            <div class="modal-desc">Verify your identity by filling in your details. All fields must match your registered account.</div>

            <div class="alert alert-error" id="verifyError">
                <span>‚ö†Ô∏è</span><span id="verifyErrorMsg">Something went wrong.</span>
            </div>

            <div class="modal-section-label">ü™™ Your Account Details</div>

            <div class="form-group">
                <label class="form-label">User ID</label>
                <div class="input-wrap">
                    <span class="input-icon">ü™™</span>
                    <input type="text" class="form-input uid-input" id="resetUserIdCode"
                           placeholder="GSS-XXXXX" maxlength="9" autocomplete="off"
                           oninput="this.value=this.value.toUpperCase()">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Full Name</label>
                <div class="input-wrap">
                    <span class="input-icon">üòä</span>
                    <input type="text" class="form-input" id="resetName" placeholder="Your registered full name">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Roll Number</label>
                <div class="input-wrap">
                    <span class="input-icon">üéí</span>
                    <input type="text" class="form-input" id="resetRollNo" placeholder="e.g. 12">
                </div>
            </div>

            <div class="two-col">
                <div class="form-group">
                    <label class="form-label">Class</label>
                    <div class="input-wrap">
                        <span class="input-icon">üè´</span>
                        <select class="form-input" id="resetClass" style="padding-left:40px;">
                            <option value="">Select</option>
                            <option value="1">Class 1</option><option value="2">Class 2</option>
                            <option value="3">Class 3</option><option value="4">Class 4</option>
                            <option value="5">Class 5</option><option value="6">Class 6</option>
                            <option value="7">Class 7</option><option value="8">Class 8</option>
                            <option value="9">Class 9</option><option value="10">Class 10</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Division</label>
                    <div class="input-wrap">
                        <span class="input-icon">üî§</span>
                        <select class="form-input" id="resetDivision" style="padding-left:40px;">
                            <option value="">Select</option>
                            <option value="A">A</option><option value="B">B</option>
                            <option value="C">C</option><option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="verifyBtn" onclick="submitVerify()">
                üîç Verify My Identity
            </button>
        </div>

        <div class="step-panel" id="step2">
            <div class="modal-icon">üîê</div>
            <div class="modal-title">Set New Password</div>
            <div class="modal-desc">Identity verified! Now choose a strong new password.</div>

            <div class="alert alert-error" id="resetError">
                <span>‚ö†Ô∏è</span><span id="resetErrorMsg">Something went wrong.</span>
            </div>

            <div class="alert alert-success" id="resetVerifiedBadge" style="margin-bottom:13px;">
                <span>‚úÖ</span><span id="resetVerifiedName">Identity confirmed!</span>
            </div>

            <div class="modal-section-label">üîë Create New Password</div>

            <div class="form-group">
                <label class="form-label">New Password</label>
                <div class="input-wrap">
                    <span class="input-icon">üîë</span>
                    <input type="password" class="form-input" id="resetNewPassword"
                           placeholder="Choose a new password"
                           oninput="checkResetStrength(this.value)">
                </div>
                <div class="pw-strength-bar"><div class="pw-strength-fill" id="resetStrengthFill"></div></div>
                <div class="pw-strength-label" id="resetStrengthLabel"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Confirm New Password</label>
                <div class="input-wrap">
                    <span class="input-icon">‚úÖ</span>
                    <input type="password" class="form-input" id="resetConfirmPassword"
                           placeholder="Type password again"
                           onkeypress="if(event.key==='Enter') submitReset()">
                </div>
            </div>

            <button class="btn btn-primary" id="resetBtn" onclick="submitReset()">
                üîê Reset My Password
            </button>
        </div>

        <div class="step-panel" id="step3">
            <div class="success-check">
                <div class="check-circle">‚úì</div>
                <div class="success-title">Password Reset!</div>
                <div class="success-msg">
                    Your password has been updated successfully.<br>
                    You can now log in with your new password. üéâ
                </div>
            </div>
            <button class="btn btn-green" onclick="closeForgotModal(); showStudentLogin();" style="margin-top:8px;">
                üöÄ Go to Login
            </button>
        </div>

    </div>
</div>

<script>
let _generatedUserId = '';
let _verifiedUserId  = '';

function switchRole(role, btn) {
    document.querySelectorAll('.role-tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('studentPanel').classList.toggle('active', role === 'student');
    document.getElementById('teacherPanel').classList.toggle('active', role === 'teacher');
    clearAlerts();
}

function showStudentLogin() {
    document.getElementById('studentLogin').style.display  = 'block';
    document.getElementById('studentSignup').style.display = 'none';
    clearAlerts();
}
function showStudentSignup() {
    document.getElementById('studentLogin').style.display  = 'none';
    document.getElementById('studentSignup').style.display = 'block';
    clearAlerts();
    document.getElementById('uidRevealBox').classList.remove('show');
}

async function loginStudent() {
    const userIdCode = document.getElementById('studentUserIdCode').value.trim().toUpperCase();
    const password   = document.getElementById('studentPassword').value;
    const btn        = document.getElementById('studentLoginBtn');

    if (!userIdCode || !password) {
        showAlert('studentLoginError','studentLoginErrorMsg','Please enter your User ID and password.');
        return;
    }
    if (!userIdCode.startsWith('GSS-') || userIdCode.length !== 9) {
        showAlert('studentLoginError','studentLoginErrorMsg','User ID format: GSS-XXXXX (9 characters).');
        return;
    }
    setLoading(btn, true, 'üöÄ Login to Learn!');
    try {
        const res  = await fetch('/login', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ role:'student', userIdCode, password })
        });
        const data = await res.json();
        if (data.success) {
            btn.innerHTML = '‚úÖ Welcome back!';
            setTimeout(() => window.location.href = '/dashboard', 600);
        } else {
            showAlert('studentLoginError','studentLoginErrorMsg', data.message || 'Invalid User ID or password.');
            setLoading(btn, false, 'üöÄ Login to Learn!');
        }
    } catch {
        showAlert('studentLoginError','studentLoginErrorMsg','Connection error. Please try again.');
        setLoading(btn, false, 'üöÄ Login to Learn!');
    }
}

async function signupStudent() {
    const name      = document.getElementById('newStudentName').value.trim();
    const rollNo    = document.getElementById('newStudentRollNo').value.trim();
    const className = document.getElementById('newStudentClass').value;
    const division  = document.getElementById('newStudentDivision').value;
    const password  = document.getElementById('newStudentPassword').value;
    const btn       = document.getElementById('studentSignupBtn');

    if (!name || !rollNo || !className || !division || !password) {
        showAlert('studentSignupError','studentSignupErrorMsg','Please fill in all fields including Class and Division.');
        return;
    }
    if (password.length < 4) {
        showAlert('studentSignupError','studentSignupErrorMsg','Password must be at least 4 characters.');
        return;
    }
    setLoading(btn, true, 'üåü Create My Account!');
    try {
        const res  = await fetch('/signup', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ role:'student', name, rollNo, className, division, password })
        });
        const data = await res.json();
        if (data.success) {
            _generatedUserId = data.userIdCode || '';
            showUserIdReveal(_generatedUserId);
            document.getElementById('studentSignupError').classList.remove('show');
            ['newStudentName','newStudentRollNo','newStudentPassword'].forEach(id =>
                document.getElementById(id).value = '');
            document.getElementById('newStudentClass').value    = '';
            document.getElementById('newStudentDivision').value = '';
            document.getElementById('strengthFill').style.width  = '0%';
            document.getElementById('strengthLabel').textContent = '';
            const backBtn = document.getElementById('backToLoginBtn');
            backBtn.textContent = 'üöÄ Go to Login';
            backBtn.style.background = 'linear-gradient(135deg,#667eea,#764ba2)';
            backBtn.style.color = 'white';
            backBtn.style.border = 'none';
        } else {
            showAlert('studentSignupError','studentSignupErrorMsg', data.message || 'Signup failed.');
        }
        setLoading(btn, false, 'üåü Create My Account!');
    } catch {
        showAlert('studentSignupError','studentSignupErrorMsg','Connection error. Please try again.');
        setLoading(btn, false, 'üåü Create My Account!');
    }
}

function showUserIdReveal(uid) {
    document.getElementById('uidRevealCode').textContent = uid;
    document.getElementById('uidRevealBox').classList.add('show');
    document.getElementById('studentUserIdCode').value = uid;
}

function copyUserId() {
    const uid = document.getElementById('uidRevealCode').textContent;
    navigator.clipboard.writeText(uid).then(() => {
        const btn = document.querySelector('.uid-copy-btn');
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = 'üìã Copy ID', 2000);
    }).catch(() => {
        const ta = document.createElement('textarea');
        ta.value = uid;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        const btn = document.querySelector('.uid-copy-btn');
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => btn.textContent = 'üìã Copy ID', 2000);
    });
}

function showTeacherLogin() {
    document.getElementById('teacherLogin').style.display  = 'block';
    document.getElementById('teacherSignup').style.display = 'none';
    clearAlerts();
}
function showTeacherSignup() {
    document.getElementById('teacherLogin').style.display  = 'none';
    document.getElementById('teacherSignup').style.display = 'block';
    clearAlerts();
}

async function loginTeacher() {
    const email    = document.getElementById('teacherEmail').value.trim();
    const password = document.getElementById('teacherPassword').value;
    const btn      = document.getElementById('teacherLoginBtn');

    if (!email || !password) {
        showAlert('teacherLoginError','teacherLoginErrorMsg','Please enter your email and password.');
        return;
    }
    setLoading(btn, true, 'üë©‚Äçüè´ Teacher Login');
    try {
        const res  = await fetch('/login', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ role:'teacher', email, password })
        });
        const data = await res.json();
        if (data.success) {
            btn.innerHTML = '‚úÖ Welcome!';
            setTimeout(() => window.location.href = '/teacher-dashboard', 600);
        } else {
            showAlert('teacherLoginError','teacherLoginErrorMsg', data.message || 'Invalid credentials.');
            setLoading(btn, false, 'üë©‚Äçüè´ Teacher Login');
        }
    } catch {
        showAlert('teacherLoginError','teacherLoginErrorMsg','Connection error. Please try again.');
        setLoading(btn, false, 'üë©‚Äçüè´ Teacher Login');
    }
}

async function signupTeacher() {
    const name     = document.getElementById('newTeacherName').value.trim();
    const email    = document.getElementById('newTeacherEmail').value.trim();
    const password = document.getElementById('newTeacherPassword').value;
    const btn      = document.getElementById('teacherSignupBtn');

    if (!name || !email || !password) {
        showAlert('teacherSignupError','teacherSignupErrorMsg','Please fill in all fields.');
        return;
    }
    setLoading(btn, true, 'üåü Register');
    try {
        const res  = await fetch('/signup', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ role:'teacher', name, email, password })
        });
        const data = await res.json();
        if (data.success) {
            document.getElementById('teacherSignupSuccess').classList.add('show');
            document.getElementById('teacherSignupError').classList.remove('show');
            setTimeout(showTeacherLogin, 1800);
        } else {
            showAlert('teacherSignupError','teacherSignupErrorMsg', data.message || 'Signup failed.');
        }
        setLoading(btn, false, 'üåü Register');
    } catch {
        showAlert('teacherSignupError','teacherSignupErrorMsg','Connection error. Please try again.');
        setLoading(btn, false, 'üåü Register');
    }
}

function openForgotModal() {
    document.getElementById('forgotModal').classList.add('open');
    goToStep(1);
    ['resetUserIdCode','resetName','resetRollNo','resetNewPassword','resetConfirmPassword'].forEach(id =>
        document.getElementById(id).value = '');
    document.getElementById('resetClass').value    = '';
    document.getElementById('resetDivision').value = '';
    document.getElementById('verifyError').classList.remove('show');
    document.getElementById('resetError').classList.remove('show');
    document.getElementById('resetVerifiedBadge').classList.remove('show');
    document.getElementById('resetStrengthFill').style.width  = '0%';
    document.getElementById('resetStrengthLabel').textContent = '';
    _verifiedUserId = '';
}
function closeForgotModal() {
    document.getElementById('forgotModal').classList.remove('open');
}
function closeForgotModalOutside(e) {
    if (e.target === document.getElementById('forgotModal')) closeForgotModal();
}
function goToStep(n) {
    document.querySelectorAll('.step-panel').forEach((p, i) => p.classList.toggle('active', i + 1 === n));
    document.querySelectorAll('.step-dot').forEach((d, i) => {
        d.classList.remove('active','done');
        if (i + 1 < n)  d.classList.add('done');
        if (i + 1 === n) d.classList.add('active');
    });
}

async function submitVerify() {
    const userIdCode = document.getElementById('resetUserIdCode').value.trim().toUpperCase();
    const name       = document.getElementById('resetName').value.trim();
    const rollNo     = document.getElementById('resetRollNo').value.trim();
    const className  = document.getElementById('resetClass').value;
    const division   = document.getElementById('resetDivision').value;
    const btn        = document.getElementById('verifyBtn');

    if (!userIdCode) { showAlert('verifyError','verifyErrorMsg','Please enter your User ID (e.g. GSS-A3K7P).'); return; }
    if (!userIdCode.startsWith('GSS-') || userIdCode.length !== 9) { showAlert('verifyError','verifyErrorMsg','User ID format must be GSS-XXXXX (9 characters).'); return; }
    if (!name)       { showAlert('verifyError','verifyErrorMsg','Please enter your full name.'); return; }
    if (!rollNo)     { showAlert('verifyError','verifyErrorMsg','Please enter your roll number.'); return; }
    if (!className || !division) { showAlert('verifyError','verifyErrorMsg','Please select your Class and Division.'); return; }

    document.getElementById('verifyError').classList.remove('show');
    setLoading(btn, true, 'üîç Verify My Identity');
    try {
        const res  = await fetch('/verify_identity', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ userIdCode, name, rollNo, className, division })
        });
        const data = await res.json();
        if (data.success) {
            _verifiedUserId = userIdCode;
            document.getElementById('resetVerifiedBadge').classList.add('show');
            document.getElementById('resetVerifiedName').textContent =
                `‚úÖ Verified: ${data.studentName || name} (${userIdCode})`;
            goToStep(2);
        } else {
            showAlert('verifyError','verifyErrorMsg', data.message || 'Details do not match. Please check and try again.');
        }
    } catch {
        showAlert('verifyError','verifyErrorMsg','Connection error. Please try again.');
    }
    setLoading(btn, false, 'üîç Verify My Identity');
}

async function submitReset() {
    const newPassword = document.getElementById('resetNewPassword').value;
    const confirmPass = document.getElementById('resetConfirmPassword').value;
    const btn         = document.getElementById('resetBtn');

    if (!newPassword || newPassword.length < 4) { showAlert('resetError','resetErrorMsg','Password must be at least 4 characters.'); return; }
    if (newPassword !== confirmPass) { showAlert('resetError','resetErrorMsg',"Passwords don't match. Please try again."); return; }

    document.getElementById('resetError').classList.remove('show');
    setLoading(btn, true, 'üîê Reset My Password');
    try {
        const res  = await fetch('/reset_password_request', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ userIdCode: _verifiedUserId, newPassword })
        });
        const data = await res.json();
        if (data.success) { goToStep(3); }
        else { showAlert('resetError','resetErrorMsg', data.message || 'Could not reset password. Please try again.'); }
    } catch {
        showAlert('resetError','resetErrorMsg','Connection error. Please try again.');
    }
    setLoading(btn, false, 'üîê Reset My Password');
}

function showAlert(alertId, msgId, msg) {
    document.getElementById(msgId).textContent = msg;
    document.getElementById(alertId).classList.add('show');
}
function clearAlerts() {
    document.querySelectorAll('.alert').forEach(a => a.classList.remove('show'));
    document.getElementById('uidRevealBox').classList.remove('show');
}
function setLoading(btn, loading, originalText) {
    btn.disabled  = loading;
    btn.innerHTML = loading ? `<span class="spinner"></span> Please wait...` : originalText;
}

function checkStrength(pw) {
    updateStrengthUI(pw, document.getElementById('strengthFill'), document.getElementById('strengthLabel'));
}
function checkResetStrength(pw) {
    updateStrengthUI(pw, document.getElementById('resetStrengthFill'), document.getElementById('resetStrengthLabel'));
}
function updateStrengthUI(pw, fill, label) {
    if (!pw) { fill.style.width = '0%'; label.textContent = ''; return; }
    let score = 0;
    if (pw.length >= 4)          score++;
    if (pw.length >= 8)          score++;
    if (/[A-Z]/.test(pw))        score++;
    if (/[0-9]/.test(pw))        score++;
    if (/[^A-Za-z0-9]/.test(pw)) score++;
    const levels = [
        { pct:'20%', color:'#d63031', text:'üò¨ Very weak' },
        { pct:'40%', color:'#e17055', text:'üòê Weak' },
        { pct:'60%', color:'#fdcb6e', text:'üôÇ Fair' },
        { pct:'80%', color:'#00b894', text:'üòä Strong' },
        { pct:'100%',color:'#0984e3', text:'üî• Very strong!' },
    ];
    const lvl = levels[Math.min(score - 1, 4)] || levels[0];
    fill.style.width      = lvl.pct;
    fill.style.background = lvl.color;
    label.textContent     = lvl.text;
    label.style.color     = lvl.color;
}

// Secret keyboard shortcut: Shift + Alt + A
document.addEventListener('keydown', e => {
    if (e.shiftKey && e.altKey && e.key === 'A') {
        window.location.href = '/admin/login';
    }
});
</script>
</body>
</html>


