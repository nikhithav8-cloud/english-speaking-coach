<!DOCTYPE html>
<html>
<head>
    <title>English Practice Friend</title>
    <link rel="stylesheet" href="/static/index.css">
</head>
<body>
<!-- <div id="logo-container">
    <img src="/static/logo.jpg" id="logo">
</div> -->

<h1 class="main-heading">Speak English</h1>
<p class="sub-heading">Practice. Improve. Speak with Confidence.</p>

<button onclick="start()">Start Speaking ğŸ¤</button>

<p id="text"></p>

<audio id="audio" controls></audio>

<p id="assistant-text"></p>


<script>
let recognition;
let isListening = false;

function initRecognition() {
    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-IN";
    recognition.interimResults = false;
    recognition.continuous = false;

    recognition.onresult = function(event) {
        const text = event.results[0][0].transcript;

        document.getElementById("text").innerText = "You said: " + text;

        fetch("/process", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ text: text })
        })
        .then(res => res.json())
        .then(data => {
            // Show assistant text
            document.getElementById("assistant-text").innerText =
                "Assistant: " + data.reply;

            // Play assistant audio
            const audio = document.getElementById("audio");
            audio.src = data.audio + "?t=" + new Date().getTime();

            audio.onended = () => {
                // ğŸ” Auto start mic after assistant finishes speaking
                recognition.start();
            };

            audio.play();
        });
    };

    recognition.onerror = function(event) {
        console.error("Speech error:", event.error);
        recognition.start(); // retry listening
    };
}

function start() {
    if (!recognition) {
        initRecognition();
    }

    if (!isListening) {
        isListening = true;
        recognition.start();
    }
}
</script>

</body>
</html>