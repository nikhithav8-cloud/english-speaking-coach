
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>English Practice Friend</title>
    <link rel="stylesheet" href="/static/index.css">
</head>

<body>

<!-- ðŸ”¹ TOP CENTER HEADER -->
<header class="top-header">
    <h1 class="main-heading">Speak English</h1>
    <p class="sub-heading">Practice. Improve. Speak with Confidence.</p>
</header>

<!-- ðŸ”¹ MAIN PAGE CONTENT -->
<div class="page-container">

    <!-- LEFT SIDE -->
    <div class="left-panel">
        <button onclick="start()" class="speak-btn">Start Speaking ðŸŽ¤</button>

        <p id="text"></p>

        <audio id="audio" controls></audio>

        <p id="assistant-text"></p>
    </div>

    <!-- RIGHT SIDE -->
    <div class="right-panel">
        <div id="typing-container">
            <p id="typing-text"></p>
        </div>
    </div>

</div>


<script>
let recognition;
let isListening = false;

function initRecognition() {
    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-IN";
    recognition.interimResults = false;
    recognition.continuous = false;

    recognition.onresult = function (event) {
        const text = event.results[0][0].transcript;

        document.getElementById("text").innerText = "You said: " + text;

        fetch("/process", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: text })
        })
        .then(res => res.json())
        .then(data => {

            // Show assistant text
            document.getElementById("assistant-text").innerText =
                "Assistant: " + data.reply;

            // Play assistant audio
            const audio = document.getElementById("audio");
            audio.src = data.audio + "?t=" + Date.now();
            audio.load();

            audio.onended = () => {
                try {
                    recognition.start();
                } catch (e) {
                    console.log("Recognition already started");
                }
            };

            audio.play().catch(err => {
                console.log("Audio play blocked:", err);
            });
        });
    };

    recognition.onerror = function (event) {
        console.error("Speech error:", event.error);
        isListening = false;
    };

    recognition.onend = function () {
        isListening = false;
    };
}

function start() {
    if (!recognition) {
        initRecognition();
    }

    if (!isListening) {
        isListening = true;
        recognition.start();
    }
}

const lines = [
    "ðŸ‘‹ Welcome to English Practice Friend!",
    "",
    "âœ¨ This app helps children",
    "learn English by speaking.",
    "",
    "âœ¨ Speak freely.",
    "âœ¨ Get corrected gently.",
    "âœ¨ Improve confidence every day.",
    "",
    "âœ¨ Learning English can be fun!",
];

const typingText = document.getElementById("typing-text");
let lineIndex = 0;
let charIndex = 0;

function typeLine() {
    if (lineIndex >= lines.length) return;

    if (charIndex < lines[lineIndex].length) {
        typingText.innerHTML += lines[lineIndex].charAt(charIndex);
        charIndex++;
        setTimeout(typeLine, 50); // typing speed
    } else {
        typingText.innerHTML += "<br>";
        charIndex = 0;
        lineIndex++;
        setTimeout(typeLine, 600); // pause between lines
    }
}

// Start typing when page loads
window.onload = () => {
    typeLine();
};
</script>

</body>
</html>
